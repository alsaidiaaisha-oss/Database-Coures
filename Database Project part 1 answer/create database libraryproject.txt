create database libraryproject
use libraryproject


create table library (
          library_id int identity(1,1) primary key,
		  name varchar(100) not null unique,
		  location varchar(100) not null ,
		  contact_no varchar(50) not null ,
		  established_year int,
		  );

create table staff (

           staffid  int identity(1,1) primary key,
		   fullname varchar(100),
		   position varchar(100),
		   contactno varchar(50),
		   libraryid int not null
		   foreign key(libraryid) references library(library_id)
		     on delete cascade
			 on update cascade
			 );






create table book (
                  
				  bookid int primary key identity(1,1),
				  isbn varchar(50) not null unique,
				  title varchar(30) not null,
				  genre varchar(30) not null,
				  price decimal(9,2) check (price> 0),
				  shelflocation varchar(50) not null,
				  status varchar(50),
				  libraryid int not null,
				  check (genre in ('Fiction', 'Non-fiction', 'Reference', 'Children')),
				  foreign key(libraryid) references library(library_id)

				       on delete cascade
			           on update cascade
					   );


create table member (
            memberid int primary key identity(1,1),
			fullname varchar(50),
			emaill varchar(100) not null unique,
			phoneno varchar(50),
			startdate date not null,
			);


);
create table loan (
                loanid int identity(1,1) primary key,
				loandate date not null,
				duedate date not null,
				returndate date,
				status varchar(30) not null,
				bookid int not null,
				memberid INT NOT NULL,
				foreign key (bookid) references book(bookid),
				foreign key (memberid) references member(memberid)

	                    on delete cascade
			           on update cascade
);

create table payment (
                paymentid int identity(1,1) primary key,
				amount decimal(9,2) not null  check (amount >0 ),
				paymentdate date not null,
				method varchar(50),
				loanid int not null,
				foreign key (loanid) references loan(loanid)
				    on delete cascade
			         on update cascade
					 );


create table review (
             reviewid int primary key identity(1,1),
			 rating int not null check (rating between 1 and 5),
			 comments varchar(600),
			 reviewdate date not null,
			 memberid int not null,
			 bookid int not null,
			 foreign key(memberid) references member(memberid),
			 foreign key(bookid) references book(bookid)

			     on delete cascade
			         on update cascade
					 );
----------

SELECT COLUMN_NAME, DATA_TYPE
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'Book';
ALTER TABLE Book
ADD is_available BIT;
ALTER TABLE Book
ADD CONSTRAINT DF_Book_IsAvailable
DEFAULT 1 FOR is_available;
UPDATE Book
SET is_available = 1
WHERE is_available IS NULL;

ALTER TABLE Book
ALTER COLUMN is_available BIT NOT NULL;

-------
ALTER TABLE Loan
ADD CONSTRAINT DF_Loan_Status
DEFAULT 'Issued' FOR Status;

ALTER TABLE Review
ADD CONSTRAINT DF_Review_Comments
DEFAULT 'No comments' FOR Comments;

--------------------------------------------------------
select * from review

insert into library( name, location, contact_no, established_year)
values
('Central Library', 'Muscat', '24567890', 2000),
('Science Library', 'Sohar', '26894512', 2010);

insert into staff(fullname,position,contactno,libraryid) 
values
('Ahmed Al Said', 'Librarian', '91234567', 1),
('Fatma Al Harthy', 'Assistant', '92345678', 2);

insert into book(isbn,title,genre,shelflocation,status,libraryid)
values
('9780131103627', 'Database Systems', 'Reference', 45.50, 'A1', 1),
('9780321751041', 'Learning SQL', 'Non-fiction', 30.00, 'B2', 1),
('9780439708180', 'Harry Potter', 'Children', 25.00, 'C3', 2);

insert into member(fullname,emaill,phoneno,startdate)
values
('Ali Al Zadjali', 'ali@email.com', '91112233', '2024-01-01'),
('Mona Al Balushi', 'mona@email.com', '92223344', '2024-02-15');

insert into loan(loandate,duedate,memberid,bookid)
values
('2025-01-01', '2025-01-15', 1, 1),
('2025-01-05', '2025-01-20', 2, 3);

insert into payment(amount,paymentdate,method,loanid)
values
(5.00, '2025-01-10', 'Cash', 1),
(3.50, '2025-01-12', 'Card', 2);

insert into review(rating,reviewdate,memberid,bookid)
values
(5, '2025-01-20', 1, 1),
(4, '2025-01-22', 2, 3);
------------------------------------------------------------------


 -----Library Database – DQL & DML Tasks-----











---------- Library Database – DQL & DML Tasks------
----Display all book records-----


University Database – JOIN Queriesselect * from Student
select * from Coures
select * from departnent
select * from Exams
select * from Faculty
select * from Hotel
select * from Student_subj
select * from subj
--Display the department ID, name, and the full name of the faculty managing it.----SELECT 
  select 
  d.D_id   AS Department_ID,
    d.D_name AS Department_Name,
    f.name   AS Faculty_Manager
FROM departnent d
LEFT JOIN Faculty f
    ON d.F_id = f.F_id;
-----Display each program's name and the name of the department offering it.----

alter table coures
add D_id int;

ALTER TABLE Coures
ADD CONSTRAINT FK_Coures_Department
FOREIGN KEY (D_id)
REFERENCES departnent(D_id);

UPDATE Coures SET D_id = 1 WHERE coures_id = 1;
UPDATE Coures SET D_id = 2 WHERE coures_id = 2;
UPDATE Coures SET D_id = 1 WHERE coures_id = 3;

SELECT 
    c.coures_name AS Program_Name,
    d.D_name      AS Department_Name
FROM Coures c
JOIN departnent d
    ON c.D_id = d.D_id;

------Display the full student data and the full name of their faculty advisor----
select 
s.S_id,
s.Fname,
s.Lname,
s.phone_no,
s.DOB,
f. name as faculty_advisor 
 from Student s
 left join Faculty f
 on s.F_id = f.F_id;
 ---Display class IDs, course titles, and room locations for classes in buildings 'A' or 'B'----

 select 
 e.exam_code as Class_ID,
 c.coures_name as Course_titles,
e.Room as Room_locations
from Exams e
left join student s 
 on e.S_id = s.S_id
 join Coures c
 on s.S_id = c.S_id
 where e.Room in ('Room A', 'Room B');
 -----Display full data about courses whose titles start with "I" (e.g., "Introduction to...")---
SELECT *
FROM dbo.Coures
WHERE coures_name LIKE 'I%';
SELECT c.*
FROM dbo.Coures c
JOIN dbo.departnent d
    ON c.D_id = d.D_id
WHERE c.coures_name LIKE 'I%';
------Display names of students in program ID 3 whose GPA is between 2.5 and 3.5----
-----Retrieve student names in the Engineering program who earned grades ≥ 90 in the "Database" course----
select
 s.Fname,
 s.Lname
 from Student s
 join Coures c
 on s.S_id = c.S_Id
 join departnent d
 on c.D_id = d.D_id
 join Exams g 
 on s.S_id = g.S_id
 where d.D_name = ' Engineering'
 and c.coures_name ='Database'
 and g.mark >=90;
 ----------------------------------------------------------
 ---
 ---Find names of students who are advised by "Dr. Ahmed Hassan"---
select
    s.Fname,
    s.Lname
from Student s
join Faculty f
    on s.F_id = f.F_id
where f.name = 'Dr. Ahmed Hassan';
-----------------------
----
---Retrieve each student's name and the titles of courses they are enrolled in, ordered by course title-----
select s.Fname, s.Lname, c.coures_name
from Student s
join Coures c ON s.S_id = c.S_id
ORDER BY c.coures_name;
--For each class in Building 'Main', retrieve class ID, course name, department name, and faculty name teaching the class.----
select e.exam_code, c.coures_name, d.D_name, f.name
from Exams e
join Student s ON e.S_id = s.S_id
Join Coures c ON s.S_id = c.S_id
Join departnent d ON c.D_id = d.D_id
Join Faculty f ON d.F_id = f.F_id
WHERE e.Room = 'Main';

-----Display all faculty members who manage any department----

select distinct  f.name
from Faculty f
Join departnent d
ON f.F_id = d.F_id;


--Display all students and their advisors' names, even if some students don’t have advisors yet-----
select  s.Fname, s.Lname, f.name
from Student s
left join Faculty f
on s.F_id = f.F_id;































